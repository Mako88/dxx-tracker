<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>DXX-Rebirth Tracker</title>
  <meta name="description" content="A game tracker for DXX-Rebirth.">
  <meta name="author" content="A Future Pilot">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="wrapper">
        <h1>DXX-Rebirth Tracker</h1>
        <p class="buttons">Show: <a href="#" id="all" style="color: #767cc9">All</a> <a href="#" id="d1x">D1X</a> <a href="#" id="d2x">D2X</a></p>

        <table>
            <thead>
                <tr>
                    <th class="version">Version</th>
                    <th class="name">Name</th>
                    <th class="mission">Mission</th>
                    <th class="players">Players</th>
                    <th class="mode">Mode</th>
                    <th class="status">Status</th>
                    <th class="host">Host</th>
                </tr>
            </thead>
            <tbody id="games">

            </tbody>
        </table>
        
        <div id="footer">
            <span>Tracker Backend Status: </span><span id="backend"></span>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script type="text/javascript">
    let gameInterval;
    $(document).ready(function(){
        
        // Both games.php and backend.php work by calling them using the ajax .load() function
        // setInterval ensures that they are called again every 5 seconds
        let query = "games.php?version=all";
        $('#games').load(query);
        gameInterval = setInterval(function() { $('#games').load(query); }, 5000);
        
        $('#backend').load('backend.php');
        setInterval(function() { $('#backend').load('backend.php'); }, 5000);
        
        // This change the GET parameter to filter games
        $(".buttons a").click(function(){
            SetActive($(this));
            query = "games.php?version=" + $(this).attr('id');
            refreshTable(query);
        });
    });

    // Set one of the filter buttons to active
    function SetActive(clicked) {
        $(".buttons").children("a").not(clicked).css("color", "#bcbcbc");
        clicked.css("color", "#767cc9");
    }
    
    // Reload the games list
    function refreshTable(query){
        clearInterval(gameInterval);
        $('#games').load(query);
        gameInterval = setInterval(function() { $('#games').load(query); }, 5000);
    }
</script>

</html>